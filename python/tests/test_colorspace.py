import unittest
import numpy as np

from pyrism.colorspace import rgb_to_xyz


class TestRgbToXyz(unittest.TestCase):
    def test_srgb(self):
        rgb_data = np.array([[0.814723686393179, 0.157613081677548, 0.655740699156587],
                             [0.905791937075619, 0.970592781760616, 0.0357116785741896],
                             [0.126986816293506, 0.957166948242946, 0.849129305868777],
                             [0.913375856139019, 0.485375648722841, 0.933993247757551],
                             [0.632359246225410, 0.800280468888800, 0.678735154857774],
                             [0.0975404049994095, 0.141886338627215, 0.757740130578333],
                             [0.278498218867048, 0.421761282626275, 0.743132468124916],
                             [0.546881519204984, 0.915735525189067, 0.392227019534168],
                             [0.957506835434298, 0.792207329559554, 0.655477890177557],
                             [0.964888535199277, 0.959492426392903, 0.171186687811562]])
        xyz_srgb_data = np.array([[0.337022048279929, 0.177048856732710, 0.383067475200876],
                                  [0.664094760025734, 0.838336983955635, 0.129447051363532],
                                  [0.454419176988889, 0.700431980369530, 0.764511364979417],
                                  [0.562087803455028, 0.378513856283563, 0.853667738249533],
                                  [0.439068186708654, 0.538422846925930, 0.476551208430729],
                                  [0.106837031372421, 0.0533761864600793, 0.510519687368064],
                                  [0.171531993916981, 0.156657099015557, 0.505499937939584],
                                  [0.423071453387219, 0.650154602077139, 0.223815617421220],
                                  [0.654749347076620, 0.643064334065245, 0.455952511114873],
                                  [0.710210025506997, 0.848868871020854, 0.149925631511349]])

        xyz = rgb_to_xyz(rgb_data, 'sRGB')
        np.testing.assert_almost_equal(xyz, xyz_srgb_data, decimal=10)

    def test_p3d65(self):
        rgb_data = np.array([[0.814723686393179, 0.157613081677548, 0.655740699156587],
                             [0.905791937075619, 0.970592781760616, 0.0357116785741896],
                             [0.126986816293506, 0.957166948242946, 0.849129305868777],
                             [0.913375856139019, 0.485375648722841, 0.933993247757551],
                             [0.632359246225410, 0.800280468888800, 0.678735154857774],
                             [0.0975404049994095, 0.141886338627215, 0.757740130578333],
                             [0.278498218867048, 0.421761282626275, 0.743132468124916],
                             [0.546881519204984, 0.915735525189067, 0.392227019534168],
                             [0.957506835434298, 0.792207329559554, 0.655477890177557],
                             [0.964888535199277, 0.959492426392903, 0.171186687811562]])
        xyz_p3d65_data = np.array([[0.388594010686544, 0.189573249581654, 0.405521092712978],
                                   [0.637520815660353, 0.829514238240341, 0.0450395834099497],
                                   [0.384545230792968, 0.684359638026524, 0.761658352980881],
                                   [0.619217161453977, 0.393185162244204, 0.903052400010577],
                                   [0.417471006072039, 0.533073713807993, 0.463944695706918],
                                   [0.115399823228415, 0.0569099984446966, 0.558958747945756],
                                   [0.171625531948228, 0.157836026375844, 0.541086838869235],
                                   [0.369350051552598, 0.636119572284037, 0.170031760925672],
                                   [0.674531606187732, 0.646771697987718, 0.430845370550325],
                                   [0.695369819399195, 0.842777230902543, 0.0669847995909036]])

        xyz = rgb_to_xyz(rgb_data, 'p3d65')
        np.testing.assert_almost_equal(xyz, xyz_p3d65_data, decimal=10)
